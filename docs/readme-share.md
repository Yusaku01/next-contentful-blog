# Next.js Ã— Contentful ãƒ–ãƒ­ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ å®Œå…¨ã‚¬ã‚¤ãƒ‰

## ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¤ã„ã¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**Next.js**ã¨**Contentful**ã‚’ä½¿ã£ãŸãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚

### ä¸»ãªç‰¹å¾´

- **Next.js App Router** ã‚’ä½¿ç”¨ã—ãŸæœ€æ–°ã®æ§‹æˆ
- **Contentful CMS** ã§ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ç®¡ç†
- **é™çš„ç”Ÿæˆï¼ˆSSGï¼‰** ã«ã‚ˆã‚Šé«˜é€Ÿãªãƒšãƒ¼ã‚¸è¡¨ç¤ºã‚’å®Ÿç¾
- **ãƒ‰ãƒ©ãƒ•ãƒˆãƒ¢ãƒ¼ãƒ‰** ã§å…¬é–‹å‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¯èƒ½
- **è‡ªå‹•æ›´æ–°æ©Ÿèƒ½** ã§CMSã®å¤‰æ›´ã‚’å³åº§ã«åæ˜ 

### ä½¿ç”¨ã—ã¦ã„ã‚‹æŠ€è¡“

- **GraphQL**: Contentfulã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«å–å¾—
- **Draft Mode**: è¨˜äº‹ã‚’å…¬é–‹ã™ã‚‹å‰ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã§ãã‚‹æ©Ÿèƒ½
- **On-Demand Revalidate**: CMSã§è¨˜äº‹ã‚’æ›´æ–°ã—ãŸã‚‰è‡ªå‹•çš„ã«ã‚µã‚¤ãƒˆã«åæ˜ ã•ã‚Œã‚‹ä»•çµ„ã¿
- **ã‚¿ã‚°ä»˜ãã‚­ãƒ£ãƒƒã‚·ãƒ¥**: å¿…è¦ãªéƒ¨åˆ†ã ã‘ã‚’åŠ¹ç‡çš„ã«æ›´æ–°

---

## ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹

å®Ÿéš›ã®å‹•ä½œã‚’ç¢ºèªã§ãã¾ã™:
ğŸ‘‰ [https://app-router-contentful.vercel.app/](https://app-router-contentful.vercel.app/)

---

## ã™ãã«å§‹ã‚ãŸã„æ–¹ã¸

ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è‡ªåˆ†å°‚ç”¨ã®ãƒ–ãƒ­ã‚°ã‚’ç°¡å˜ã«ä½œæˆã§ãã¾ã™ã€‚

**ä½•ãŒèµ·ã“ã‚‹ã®ï¼Ÿ**
1. ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ãªãŸã®GitHubã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™
2. Vercelã«è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™
3. Contentful Integrationã‚’é€šã˜ã¦ã€è‡ªå‹•çš„ã«Contentfulã¨æ¥ç¶šã•ã‚Œã¾ã™

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Ftree%2Fcanary%2Fexamples%2Fcms-contentful&project-name=nextjs-contentful-blog&repository-name=nextjs-contentful-blog&demo-title=Next.js+Blog&demo-description=Static+blog+with+multiple+authors+using+Draft+Mode&demo-url=https%3A%2F%2Fnext-blog-contentful.vercel.app%2F&demo-image=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Fv1625705016%2Ffront%2Fexamples%2FCleanShot_2021-07-07_at_19.43.15_2x.png&integration-ids=oac_aZtAZpDfT1lX3zrnWy7KT9VA&env=CONTENTFUL_PREVIEW_SECRET&envDescription=Any%20URL%20friendly%20value%20to%20secure%20Draft%20Mode)

---

## ä»–ã®CMSã‚µãƒ³ãƒ—ãƒ«ã‚‚è¦‹ã‚‹

Next.jsã¯æ§˜ã€…ãªCMSã¨é€£æºã§ãã¾ã™:

AgilityCMS / Builder.io / ButterCMS / Contentful / Cosmic / DatoCMS / DotCMS / Drupal / Enterspeed / Ghost / GraphCMS / Kontent.ai / MakeSwift / Payload / Plasmic / Prepr / Prismic / Sanity / Sitecore XM Cloud / Sitefinity / Storyblok / TakeShape / Tina / Umbraco / Umbraco heartcore / Webiny / WordPress / Blog Starter

---

## ğŸ“¦ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å§‹ã‚ã‚‹

ãŠä½¿ã„ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã€ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

**npm ã‚’ä½¿ã†å ´åˆ:**
```bash
npx create-next-app --example cms-contentful cms-contentful-app
```

**yarn ã‚’ä½¿ã†å ´åˆ:**
```bash
yarn create next-app --example cms-contentful cms-contentful-app
```

**pnpm ã‚’ä½¿ã†å ´åˆ:**
```bash
pnpm create next-app --example cms-contentful cms-contentful-app
```

> ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã©ã‚Œã‚’ä½¿ãˆã°ã„ã„ã‹è¿·ã£ãŸã‚‰ã€`npx`ï¼ˆnpmä»˜å±ï¼‰ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

---

## âš™ï¸ è©³ç´°è¨­å®šã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ–ãƒ­ã‚°ã‚’å‹•ã‹ã™ã«ã¯ã€Contentfulã¨ã„ã†CMSã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚
é †ç•ªã«é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ï¼

---

### Step 1. Contentfulã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹

**Contentfulã¨ã¯ï¼Ÿ**
ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚„ç”»åƒã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ã€ã‚¯ãƒ©ã‚¦ãƒ‰å‹ã®CMSï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã§ã™ã€‚

#### æ‰‹é †

1. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²**
   [Contentful](https://www.contentful.com/sign-up/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ç„¡æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

2. **Spaceã‚’ä½œæˆ**
   [ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰](https://app.contentful.com/) ã‹ã‚‰ã€Œç©ºã®Spaceã€ã‚’æ–°è¦ä½œæˆã—ã¾ã™ã€‚

   > ğŸ“ **Spaceã¨ã¯ï¼Ÿ**: ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ã‚„ç”»åƒã‚’ä¿å­˜ã™ã‚‹å ´æ‰€ã§ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«1ã¤ã®Spaceã‚’ä½œã‚Šã¾ã™ã€‚

   Spaceåã¯è‡ªç”±ã«ä»˜ã‘ã‚‰ã‚Œã¾ã™ï¼ˆä¾‹: `My Blog`ï¼‰ã€‚

---

### Step 2. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹

**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ«ã¨ã¯ï¼Ÿ**
ãƒ–ãƒ­ã‚°ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®å‹ï¼ˆè¨­è¨ˆå›³ï¼‰ã‚’å®šç¾©ã™ã‚‹ã‚‚ã®ã§ã™ã€‚
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ŒAuthorï¼ˆè‘—è€…ï¼‰ã€ã¨ã€ŒPostï¼ˆè¨˜äº‹ï¼‰ã€ã®2ç¨®é¡ã‚’ä½œã‚Šã¾ã™ã€‚

ä½œæˆæ–¹æ³•ã¯2ã¤ã‚ã‚Šã¾ã™:

- **æ–¹æ³•A**: è‡ªå‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ä½œæˆï¼ˆç°¡å˜ãƒ»æ¨å¥¨ï¼‰
- **æ–¹æ³•B**: æ‰‹å‹•ã§ä½œæˆï¼ˆç´°ã‹ãç†è§£ã—ãŸã„æ–¹å‘ã‘ï¼‰

---

#### æ–¹æ³•A: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è‡ªå‹•ä½œæˆï¼ˆæ¨å¥¨ï¼‰

è‡ªå‹•çš„ã«ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¦ãã‚Œã‚‹ã®ã§ã€åˆå¿ƒè€…ã«ã¯ã“ã¡ã‚‰ãŒãŠã™ã™ã‚ã§ã™ã€‚

**â‘  Space IDã¨Management Tokenã‚’å–å¾—**

1. Contentfulã® **Settings > General Settings** ã‚’é–‹ã
2. **Space ID** ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãï¼ˆä¾‹: `abc123xyz`ï¼‰
3. **Settings > CMA tokens** ã‚’é–‹ã
4. **Create personal access token** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆ
5. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠã

   > âš ï¸ **æ³¨æ„**: Management Tokenã¯å¼·åŠ›ãªæ¨©é™ã‚’æŒã¤ã®ã§ã€ä»–äººã«è¦‹ã›ãªã„ã§ãã ã•ã„ã€‚
   > ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒçµ‚ã‚ã£ãŸã‚‰å‰Šé™¤ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚

**â‘¡ ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:

```bash
npx cross-env CONTENTFUL_SPACE_ID=ã‚ãªãŸã®Space_ID CONTENTFUL_MANAGEMENT_TOKEN=ã‚ãªãŸã®Token npm run setup
```

**â‘¢ æˆåŠŸã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™:**

```
> cms-contentful@1.0.0 setup
> node ./contentful/setup.js

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ The following entities are going to be imported: â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Content Types                   â”‚ 2              â”‚  â† Authorã¨postãŒä½œæˆã•ã‚Œã‚‹
â”‚ Editor Interfaces               â”‚ 2              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ã“ã‚Œã§ã€ŒAuthorã€ã¨ã€ŒPostã€ã®ãƒ¢ãƒ‡ãƒ«ãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã—ãŸï¼

â†’ **Step 3ã«é€²ã‚“ã§ãã ã•ã„**

---

#### æ–¹æ³•B: æ‰‹å‹•ã§ä½œæˆ

å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è‡ªåˆ†ã§è¨­å®šã—ãŸã„å ´åˆã¯ã€ã“ã¡ã‚‰ã®æ–¹æ³•ã§é€²ã‚ã¾ã™ã€‚

**â‘  Authorãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ**

1. Contentfulã® **Content model** ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã
2. **Add content type** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®š:
   - **Name**: `Author`ï¼ˆè‘—è€…ï¼‰
   - **API Identifier**: `author`
4. **Add field** ã§ä»¥ä¸‹ã®2ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ :

   | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | ã‚¿ã‚¤ãƒ— | Field ID | èª¬æ˜ |
   |------------|--------|----------|------|
   | `name` | Textï¼ˆShort textï¼‰ | `name` | è‘—è€…ã®åå‰ |
   | `picture` | Mediaï¼ˆOne fileï¼‰ | `picture` | è‘—è€…ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ |

5. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

**â‘¡ Postãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ**

1. å†ã³ **Add content type** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®š:
   - **Name**: `Post`ï¼ˆè¨˜äº‹ï¼‰
   - **API Identifier**: `post`
3. **Add field** ã§ä»¥ä¸‹ã®7ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ :

   | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
   |------------|--------|------|
   | `title` | Textï¼ˆShort textï¼‰ | è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ« |
   | `content` | Rich text | è¨˜äº‹ã®æœ¬æ–‡ |
   | `excerpt` | Textï¼ˆLong textï¼‰ | è¨˜äº‹ã®è¦ç´„æ–‡ |
   | `coverImage` | Mediaï¼ˆOne fileï¼‰ | è¨˜äº‹ã®ã‚«ãƒãƒ¼ç”»åƒ |
   | `date` | Date and time | å…¬é–‹æ—¥æ™‚ |
   | `slug` | Textï¼ˆShort textï¼‰ | URLã«ä½¿ã†æ–‡å­—åˆ—ï¼ˆä¾‹: `my-first-post`ï¼‰ |
   | `author` | Referenceï¼ˆOne referenceï¼‰ | è‘—è€…ã¸ã®å‚ç…§ï¼ˆä¸Šã§ä½œã£ãŸAuthorã‚’é¸æŠï¼‰ |

   > ğŸ’¡ **slugãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ’ãƒ³ãƒˆ**:
   > - Field ã® **Appearance** ã‚¿ãƒ–ã§ã€ŒSlugã€è¡¨ç¤ºã‚’é¸æŠã§ãã¾ã™
   > - `title` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã™ã‚‹è¨­å®šã‚‚å¯èƒ½ã§ã™

4. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

---

### Step 3. ãƒ¢ãƒ‡ãƒ«ãŒæ­£ã—ãä½œæˆã•ã‚ŒãŸã‹ç¢ºèª

Content modelãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã‚Œã°OKã§ã™:

![Content model overview](https://github.com/vercel/next.js/assets/9113740/d3f76907-7046-4d94-b285-eb89b87aa223)

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- `Author` ãƒ¢ãƒ‡ãƒ«: nameã¨pictureã®2ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- `Post` ãƒ¢ãƒ‡ãƒ«: titleã€contentã€excerptã€coverImageã€dateã€slugã€authorã®7ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

---

### Step 4. ãƒ†ã‚¹ãƒˆç”¨ã®è¨˜äº‹ã‚’ä½œæˆã™ã‚‹

ãƒ¢ãƒ‡ãƒ«ãŒã§ããŸã®ã§ã€å®Ÿéš›ã«ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼

#### â‘  è‘—è€…ã‚’ä½œæˆ

1. **Content** ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã
2. **Add entry** â†’ **Author** ã‚’é¸æŠ
3. ä»¥ä¸‹ã‚’å…¥åŠ›:
   - **name**: ã‚ãªãŸã®åå‰ï¼ˆä¾‹: `å±±ç”°å¤ªéƒ`ï¼‰
   - **picture**: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
     > ğŸ’¡ ç”»åƒãŒãªã„å ´åˆã¯ [Unsplash](https://unsplash.com/) ã‹ã‚‰ç„¡æ–™ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™

4. **Publish** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

   > âš ï¸ **é‡è¦**: å¿…ãš**Publishï¼ˆå…¬é–‹ï¼‰**ã—ã¦ãã ã•ã„ï¼
   > å…¬é–‹ã—ãªã„ã¨ãƒ‰ãƒ©ãƒ•ãƒˆçŠ¶æ…‹ã®ã¾ã¾ã§ã€ã‚µã‚¤ãƒˆã«è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

#### â‘¡ è¨˜äº‹ã‚’ä½œæˆï¼ˆæœ€ä½2ä»¶ï¼‰

1. **Add entry** â†’ **Post** ã‚’é¸æŠ
2. å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥åŠ›:
   - **title**: `ã¯ã˜ã‚ã¦ã®è¨˜äº‹`
   - **slug**: `my-first-post`ï¼ˆURLã«ãªã‚‹éƒ¨åˆ†ï¼‰
   - **excerpt**: `ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆè¨˜äº‹ã§ã™`ï¼ˆè¦ç´„æ–‡ï¼‰
   - **content**: æœ¬æ–‡ã‚’è‡ªç”±ã«æ›¸ã
   - **coverImage**: ã‚«ãƒãƒ¼ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - **date**: ä»Šæ—¥ã®æ—¥ä»˜
   - **author**: å…ˆã»ã©ä½œã£ãŸè‘—è€…ã‚’é¸æŠ

3. **Publish** ã‚’ã‚¯ãƒªãƒƒã‚¯

4. ã‚‚ã†1ä»¶ã€åŒæ§˜ã®æ‰‹é †ã§è¨˜äº‹ã‚’ä½œæˆ

ã“ã‚Œã§æº–å‚™å®Œäº†ã§ã™ï¼

![Published content entry](https://github.com/vercel/next.js/assets/9113740/e1b4a3fe-45f4-4851-91db-8908d3ca18e9)

---

### Step 5. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹

**ç’°å¢ƒå¤‰æ•°ã¨ã¯ï¼Ÿ**
Next.jsã‚¢ãƒ—ãƒªãŒContentfulã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®ã€Œéµã€ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚
ã“ã®éµã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¨­å®šã—ã¾ã™ã€‚

#### â‘  APIã‚­ãƒ¼ã‚’å–å¾—

1. Contentfulã® **Settings > API keys** ã‚’é–‹ã
2. **Example Key** ã¾ãŸã¯ **Add API key** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã®æƒ…å ±ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã:
   - **Space ID**
   - **Content Delivery API - access token**ï¼ˆæœ¬ç•ªç”¨ï¼‰
   - **Content Preview API - access token**ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰

   > ğŸ“ **2ç¨®é¡ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®é•ã„**:
   > - **Delivery API**: å…¬é–‹æ¸ˆã¿ã®è¨˜äº‹ã‚’å–å¾—
   > - **Preview API**: ä¸‹æ›¸ãçŠ¶æ…‹ã®è¨˜äº‹ã‚‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã§ãã‚‹

#### â‘¡ ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ:

   ```bash
   cp .env.local.example .env.local
   ```

   ã“ã‚Œã§ `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

2. `.env.local` ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®š:

   ```bash
   # Contentful Space ID
   CONTENTFUL_SPACE_ID=ã‚ãªãŸã®Space_ID

   # æœ¬ç•ªç”¨ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå…¬é–‹æ¸ˆã¿è¨˜äº‹ã‚’å–å¾—ï¼‰
   CONTENTFUL_ACCESS_TOKEN=ã‚ãªãŸã®Delivery_API_Token

   # ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆä¸‹æ›¸ãã‚‚è¡¨ç¤ºï¼‰
   CONTENTFUL_PREVIEW_ACCESS_TOKEN=ã‚ãªãŸã®Preview_API_Token

   # Draft Modeç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆä»»æ„ã®æ–‡å­—åˆ—ã§OKï¼‰
   CONTENTFUL_PREVIEW_SECRET=my-secret-password

   # è‡ªå‹•æ›´æ–°ç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆä»»æ„ã®æ–‡å­—åˆ—ã§OKï¼‰
   CONTENTFUL_REVALIDATE_SECRET=my-revalidate-secret
   ```

   > ğŸ’¡ **Secretã«ã¤ã„ã¦**:
   > `CONTENTFUL_PREVIEW_SECRET` ã¨ `CONTENTFUL_REVALIDATE_SECRET` ã¯è‡ªåˆ†ã§å¥½ããªæ–‡å­—åˆ—ã‚’è¨­å®šã§ãã¾ã™ã€‚
   > ä¾‹: `my-preview-123` ã‚„ `update-webhook-456` ãªã©

3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜

   > âš ï¸ **é‡è¦**: `.env.local` ã¯Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„ï¼
   > ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯é‡è¦ãªèªè¨¼æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

---

### Step 6. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ã‹ã—ã¦ã¿ã‚‹

ã„ã‚ˆã„ã‚ˆãƒ–ãƒ­ã‚°ã‚’èµ·å‹•ã—ã¾ã™ï¼

#### â‘  ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ:

```bash
npm install
```

ã¾ãŸã¯

```bash
yarn install
```

ã“ã‚Œã§å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã™ã¹ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

#### â‘¡ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

```bash
npm run dev
```

ã¾ãŸã¯

```bash
yarn dev
```

#### â‘¢ ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã®URLã‚’é–‹ã:
ğŸ‘‰ **http://localhost:3000**

Contentfulã§ä½œæˆã—ãŸè¨˜äº‹ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ï¼

> â“ **ã†ã¾ãè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ**:
> - `.env.local` ã®å€¤ãŒæ­£ã—ã„ã‹ç¢ºèª
> - Contentfulã§è¨˜äº‹ã‚’**Publish**ã—ã¦ã„ã‚‹ã‹ç¢ºèª
> - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ã„ã‚‹å ´åˆã¯ [GitHub Discussions](https://github.com/vercel/next.js/discussions) ã§è³ªå•ã§ãã¾ã™

---

### Step 7. Draft Modeï¼ˆä¸‹æ›¸ããƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ã‚’è©¦ã™

**Draft Modeã¨ã¯ï¼Ÿ**
è¨˜äº‹ã‚’å…¬é–‹ã™ã‚‹å‰ã«ã€ã©ã†è¡¨ç¤ºã•ã‚Œã‚‹ã‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚

#### â‘  Contentfulã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š

1. Contentfulã® **Settings > Content preview** ã‚’é–‹ã
2. **Add content preview** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®š:
   - **Name**: `Development Preview`ï¼ˆä»»æ„ã®åå‰ï¼‰
   - **Content type**: `Post` ã‚’é¸æŠ
   - **URL**: ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ

   ```
   http://localhost:3000/api/draft?secret=ã‚ãªãŸã®PREVIEW_SECRET&slug={entry.fields.slug}
   ```

   > âš ï¸ `ã‚ãªãŸã®PREVIEW_SECRET` ã®éƒ¨åˆ†ã¯ã€`.env.local` ã§è¨­å®šã—ãŸ `CONTENTFUL_PREVIEW_SECRET` ã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„

4. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

![Content preview setup](https://github.com/vercel/next.js/assets/9113740/f1383d68-ea2b-4adf-974f-235b8c098745)

#### â‘¡ ä¸‹æ›¸ãã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

1. Contentfulã® **Content** ã‹ã‚‰æ—¢å­˜ã®Postã‚’é–‹ã
2. ã‚¿ã‚¤ãƒˆãƒ«ã« `[Draft]` ã¨ã„ã†æ–‡å­—ã‚’è¿½åŠ 
3. **ä¿å­˜ã™ã‚‹ãŒã€Publishã¯ã—ãªã„**ï¼ˆçŠ¶æ…‹ãŒã€ŒCHANGEDã€ã«ãªã‚‹ï¼‰
4. å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã® **Open preview** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

![Content entry overview](https://github.com/vercel/next.js/assets/9113740/cc0dff9a-c57e-4ec4-85f1-22ab74af2b6b)

ã™ã‚‹ã¨ã€å…¬é–‹ã—ã¦ã„ãªã„ä¸‹æ›¸ãçŠ¶æ…‹ã®è¨˜äº‹ãŒãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã§ãã¾ã™ï¼

#### â‘¢ Draft Modeã‚’è§£é™¤

ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†ã™ã‚‹ã«ã¯:
ğŸ‘‰ **http://localhost:3000/api/disable-draft** ã«ã‚¢ã‚¯ã‚»ã‚¹

ã“ã‚Œã§é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚Šã¾ã™ã€‚

---

### Step 8. æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã„ãŸã‚‰ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«å…¬é–‹ã—ã¾ã—ã‚‡ã†ï¼
Vercelã¨ã„ã†ç„¡æ–™ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã„ã¾ã™ã€‚

#### æ–¹æ³•A: GitHubã‹ã‚‰è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

**â‘  GitHubã«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥**

```bash
git add .
git commit -m "Initial commit"
git push
```

**â‘¡ Vercelã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**

1. [Vercel](https://vercel.com/new) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠã—ã¦ **Import**
3. **Environment Variables** ã‚’è¨­å®š:
   - `.env.local` ã¨åŒã˜å†…å®¹ã‚’ã™ã¹ã¦ã‚³ãƒ”ãƒ¼
   - å„å¤‰æ•°ã‚’1ã¤ãšã¤è¿½åŠ ã—ã¦ã„ã

   > ğŸ“ **è¿½åŠ ã™ã‚‹ç’°å¢ƒå¤‰æ•°**:
   > - `CONTENTFUL_SPACE_ID`
   > - `CONTENTFUL_ACCESS_TOKEN`
   > - `CONTENTFUL_PREVIEW_ACCESS_TOKEN`
   > - `CONTENTFUL_PREVIEW_SECRET`
   > - `CONTENTFUL_REVALIDATE_SECRET`

4. **Deploy** ã‚’ã‚¯ãƒªãƒƒã‚¯

æ•°åˆ†ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã€URLãŒç™ºè¡Œã•ã‚Œã¾ã™ï¼

#### æ–¹æ³•B: ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤

ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ä½¿ã†ã¨ã€ã•ã‚‰ã«ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™:

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Ftree%2Fcanary%2Fexamples%2Fcms-contentful&project-name=nextjs-contentful-blog&repository-name=nextjs-contentful-blog&demo-title=Next.js+Blog&demo-description=Static+blog+with+multiple+authors+using+Draft+Mode&demo-url=https%3A%2F%2Fnext-blog-contentful.vercel.app%2F&demo-image=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Fv1625705016%2Ffront%2Fexamples%2FCleanShot_2021-07-07_at_19.43.15_2x.png&integration-ids=oac_aZtAZpDfT1lX3zrnWy7KT9VA&env=CONTENTFUL_PREVIEW_SECRET,CONTENTFUL_REVALIDATE_SECRET&envDescription=Any%20URL%20friendly%20value%20to%20secure%20Your%20App)

> ğŸ’¡ ã“ã®ãƒœã‚¿ãƒ³ã‚’ä½¿ã†ã¨ã€Vercel Contentful IntegrationãŒè‡ªå‹•çš„ã«Contentfulã¨æ¥ç¶šã—ã¦ãã‚Œã¾ã™ã€‚
> ãŸã ã—ã€`CONTENTFUL_PREVIEW_SECRET` ã¨ `CONTENTFUL_REVALIDATE_SECRET` ã¯æ‰‹å‹•ã§è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

### Step 9. è‡ªå‹•æ›´æ–°æ©Ÿèƒ½ã‚’è¨­å®šã™ã‚‹ï¼ˆOn-Demand Revalidationï¼‰

**On-Demand Revalidationã¨ã¯ï¼Ÿ**
Contentfulã§è¨˜äº‹ã‚’ç·¨é›†ã—ãŸã‚‰ã€è‡ªå‹•çš„ã«ã‚µã‚¤ãƒˆã«åæ˜ ã•ã‚Œã‚‹ä»•çµ„ã¿ã§ã™ã€‚
Webhookã¨ã„ã†æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€Contentfulã‹ã‚‰Vercelã«ã€Œæ›´æ–°ã—ãŸã‚ˆï¼ã€ã¨é€šçŸ¥ã—ã¾ã™ã€‚

#### â‘  Webhookã‚’ä½œæˆ

1. Contentfulã® **Settings > Webhooks** ã‚’é–‹ã
2. **Add Webhook** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®š:

   **åŸºæœ¬è¨­å®š:**
   - **Name**: `Vercel Deploy Hook`ï¼ˆä»»æ„ã®åå‰ï¼‰
   - **URL**:
     ```
     https://ã‚ãªãŸã®Vercelã®URL/api/revalidate
     ```
     > ğŸ’¡ Vercelã®URLã¯ã€ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç¢ºèªã§ãã¾ã™
     > ï¼ˆä¾‹: `https://my-blog-abc123.vercel.app/api/revalidate`ï¼‰

   ![Content webhook url](https://github.com/vercel/next.js/assets/9113740/c8df492a-57d6-42a1-8a3c-b0de3d6ad42f)

   **Triggersï¼ˆã„ã¤é€šçŸ¥ã™ã‚‹ã‹ï¼‰:**
   - `Publish` ã¨ `Unpublish` ã«ãƒã‚§ãƒƒã‚¯
   - ã¾ãŸã¯ã€Œã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆã€ã‚’é¸æŠ

   **Headersï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼‰:**
   - **Key**: `x-vercel-reval-key`
   - **Value**: `.env.local` ã® `CONTENTFUL_REVALIDATE_SECRET` ã¨åŒã˜å€¤

   ![Content secret header](https://github.com/vercel/next.js/assets/9113740/574935e6-0d31-4e4f-b914-8b01bdf03d5e)

   **Content type:**
   - `application/json` ã‚’é¸æŠ

   ![Content publish changes](https://github.com/vercel/next.js/assets/9113740/78bd856c-ece1-4bf3-a330-1d544abd858d)

4. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

#### â‘¡ å‹•ä½œç¢ºèª

1. Contentfulã§æ—¢å­˜ã®è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´
2. **Publish** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æ•°ç§’å¾…ã£ã¦ã‹ã‚‰ã€Vercelã®ã‚µã‚¤ãƒˆã‚’å†èª­ã¿è¾¼ã¿

å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚Œã°æˆåŠŸã§ã™ï¼

![Content publish changes](https://github.com/vercel/next.js/assets/9113740/ad96bfa7-89c1-4e46-9d9c-9067176c9769)

#### â‘¢ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**ã†ã¾ãåæ˜ ã•ã‚Œãªã„å ´åˆ:**

1. **Webhookã®ãƒ­ã‚°ã‚’ç¢ºèª**
   - Contentfulã® Webhooksè¨­å®šã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°ã‚’ç¢ºèª
   - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ `200` ãŒè¿”ã£ã¦ã„ã‚Œã°OK

   ![Content successful request](https://github.com/vercel/next.js/assets/9113740/ed1ffbe9-4dbf-4ec6-9c1f-39c8949c4d38)

2. **ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª**
   - Vercelã®ç’°å¢ƒå¤‰æ•° `CONTENTFUL_REVALIDATE_SECRET` ãŒæ­£ã—ã„ã‹ç¢ºèª
   - Webhookã® `x-vercel-reval-key` ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª

3. **Vercelã®é–¢æ•°ãƒ­ã‚°ã‚’ç¢ºèª**
   - Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã® **Functions** ã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

---

ğŸ‰ **ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼**
ã“ã‚Œã§ã€ContentfulÃ—Next.jsã®ãƒ–ãƒ­ã‚°ãŒå®Œæˆã—ã¾ã—ãŸï¼

---

## ğŸ“š æŠ€è¡“è©³ç´°ï¼ˆã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„æ–¹ã¸ï¼‰

ã“ã“ã‹ã‚‰ã¯ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»•çµ„ã¿ã‚’ã‚‚ã£ã¨æ·±ãç†è§£ã—ãŸã„æ–¹å‘ã‘ã®æƒ…å ±ã§ã™ã€‚

---

### Q1. Contentfulã¨Next.jsã¯ã©ã†ã‚„ã£ã¦é€šä¿¡ã—ã¦ã„ã‚‹ã®ï¼Ÿ

**A: GraphQL APIã§é€šä¿¡ã—ã¦ã„ã¾ã™**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Contentfulã®GraphQL APIã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

**ä»•çµ„ã¿:**
- `lib/api.ts` ã§ GraphQL ã‚¯ã‚¨ãƒªã‚’å®šç¾©
- `fetch` ã‚’ä½¿ã£ã¦ Contentful ã® GraphQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- 2ç¨®é¡ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã„åˆ†ã‘:
  - **Delivery API**: å…¬é–‹æ¸ˆã¿è¨˜äº‹ã‚’å–å¾—ï¼ˆé€šå¸¸è¡¨ç¤ºç”¨ï¼‰
  - **Preview API**: ä¸‹æ›¸ãã‚‚å«ã‚ã¦å–å¾—ï¼ˆDraft Modeç”¨ï¼‰

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:**
- APIã‚­ãƒ¼ã¯ `.env.local` ã«ä¿å­˜ï¼ˆGitã«ã¯å«ã‚ãªã„ï¼‰
- Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã‚‚åŒã˜ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
- ã“ã‚Œã«ã‚ˆã‚Šã€ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¼æ´©ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«

---

### Q2. Draft Modeã¨On-Demand Revalidationã®ä»•çµ„ã¿ã¯ï¼Ÿ

**Draft Mode:**
- `app/api/draft/route.ts` ãŒ Contentful ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹
- `secret` ã¨ `slug` ã‚’æ¤œè¨¼ã—ã¦ã€æ­£ã—ã‘ã‚Œã° Next.js ã® draft mode ã‚’æœ‰åŠ¹åŒ–
- æœ‰åŠ¹åŒ–ã•ã‚Œã‚‹ã¨ã€Preview API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ãªã‚‹
- è§£é™¤ã¯ `app/api/disable-draft/route.ts` ã§ `draftMode().disable()` ã‚’å‘¼ã¶ã ã‘

**On-Demand Revalidation:**
- Contentful Webhook ãŒ `app/api/revalidate/route.ts` ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- `x-vercel-reval-key` ãƒ˜ãƒƒãƒ€ã§ `CONTENTFUL_REVALIDATE_SECRET` ã‚’æ¤œè¨¼
- æ¤œè¨¼æˆåŠŸã—ãŸã‚‰ `revalidateTag("posts")` ã‚’å®Ÿè¡Œ
- é–¢é€£ã™ã‚‹ãƒšãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå†ç”Ÿæˆã•ã‚Œã‚‹

---

### Q3. ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã‚³ãƒ¼ãƒ‰ï¼ˆ`lib/api.ts`ï¼‰ã«ã¤ã„ã¦

**ä¸»è¦ãªé–¢æ•°:**

1. **`fetchGraphQL(query, preview)`**
   - Contentfulã®GraphQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   - `preview` ãŒ true ãªã‚‰ Preview APIã€false ãªã‚‰ Delivery API ã‚’ä½¿ç”¨
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚° `["posts"]` ã‚’è¨­å®šï¼ˆRevalidationç”¨ï¼‰

2. **`getAllPosts(isDraftMode)`**
   - ã™ã¹ã¦ã®è¨˜äº‹ã‚’æ—¥ä»˜é †ï¼ˆæ–°ã—ã„é †ï¼‰ã§å–å¾—
   - ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆ`app/page.tsx`ï¼‰ã§ä½¿ç”¨
   - ãƒ’ãƒ¼ãƒ­ãƒ¼è¨˜äº‹ + ãã®ä»–ã®è¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤º

3. **`getPostAndMorePosts(slug, preview)`**
   - æŒ‡å®šã—ãŸslugã®è¨˜äº‹ã¨ã€é–¢é€£è¨˜äº‹2ä»¶ã‚’å–å¾—
   - è¨˜äº‹è©³ç´°ãƒšãƒ¼ã‚¸ï¼ˆ`app/posts/[slug]/page.tsx`ï¼‰ã§ä½¿ç”¨

4. **`getPreviewPostBySlug(slug)`**
   - Draft Modeç”¨ã«ä¸‹æ›¸ãè¨˜äº‹ã‚’å–å¾—
   - `app/api/draft/route.ts` ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹

**GraphQLã‚¯ã‚¨ãƒªã®æ§‹é€ :**
- `POST_GRAPHQL_FIELDS` ã§å…±é€šã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
- slug, title, coverImage, date, author, excerpt, content ãªã©ã‚’å–å¾—
- author ã¯ Referenceå‹ãªã®ã§ã€name ã¨ picture ã‚‚åŒæ™‚å–å¾—

---

### Q4. è¨˜äº‹ã®æ›´æ–°ã¯ã©ã†ã„ã†æµã‚Œã§åæ˜ ã•ã‚Œã‚‹ï¼Ÿ

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: ä¸‹æ›¸ãã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**
1. Contentfulã§è¨˜äº‹ã‚’ç·¨é›†ï¼ˆPublishã—ãªã„ï¼‰
2. Contentfulã®ã€ŒOpen previewã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `/api/draft?secret=...&slug=...` ã«ã‚¢ã‚¯ã‚»ã‚¹
4. `draftMode().enable()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
5. ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã ã‘ Preview API ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
6. ä¸‹æ›¸ãçŠ¶æ…‹ã®è¨˜äº‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**ãƒ‘ã‚¿ãƒ¼ãƒ³2: è¨˜äº‹ã‚’å…¬é–‹ãƒ»æ›´æ–°**
1. Contentfulã§è¨˜äº‹ã‚’ç·¨é›†
2. **Publish** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. Webhook ãŒ `/api/revalidate` ã‚’å‘¼ã³å‡ºã™
4. Secret ã‚’æ¤œè¨¼ã—ã¦ `revalidateTag("posts")` ã‚’å®Ÿè¡Œ
5. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¨è©²å½“è¨˜äº‹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå†ç”Ÿæˆ
6. æ•°ç§’å¾Œã«ã‚µã‚¤ãƒˆã«åæ˜ ã•ã‚Œã‚‹

---

### Q5. URLã¯ã©ã†ã‚„ã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ã®ï¼Ÿ

**é™çš„ç”Ÿæˆï¼ˆSSGï¼‰ã®ä»•çµ„ã¿:**
- `app/posts/[slug]/page.tsx` ã« `generateStaticParams` ã‚’å®Ÿè£…
- ãƒ“ãƒ«ãƒ‰æ™‚ã«Contentfulã‹ã‚‰å…¨è¨˜äº‹ã®slugã‚’å–å¾—
- `/posts/<slug>` ã¨ã„ã†ãƒ«ãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ
- slugã‚’å¤‰æ›´ã™ã‚Œã°ã€URLã‚‚è‡ªå‹•çš„ã«å¤‰ã‚ã‚‹

**ä¾‹:**
- slug: `my-first-post` â†’ URL: `/posts/my-first-post`
- slug: `hello-world` â†’ URL: `/posts/hello-world`

---

### Q6. SEOï¼ˆãƒ¡ã‚¿ã‚¿ã‚°ï¼‰ã¯ã©ã†è¨­å®šã™ã‚‹ï¼Ÿ

**ç¾çŠ¶:**
- `app/layout.tsx` ã§å…¨ãƒšãƒ¼ã‚¸å…±é€šã® title/description ã‚’è¨­å®š

**è¨˜äº‹ã”ã¨ã«ãƒ¡ã‚¿ã‚¿ã‚°ã‚’è¨­å®šã™ã‚‹ã«ã¯:**

`app/posts/[slug]/page.tsx` ã«ä»¥ä¸‹ã‚’è¿½åŠ :

```typescript
export async function generateMetadata({ params }) {
  const { post } = await getPostAndMorePosts(params.slug, false);

  return {
    title: post.title,
    description: post.excerpt,
    openGraph: {
      title: post.title,
      description: post.excerpt,
      images: [post.coverImage.url],
    },
    twitter: {
      card: 'summary_large_image',
      title: post.title,
      description: post.excerpt,
      images: [post.coverImage.url],
    },
  };
}
```

ã“ã‚Œã§Twitterã‚„Facebookã§ã‚·ã‚§ã‚¢ã—ãŸæ™‚ã«ã€è¨˜äº‹ã”ã¨ã®ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼

---

### Q7. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä»•çµ„ã¿ã¯ï¼Ÿ

**Next.js App Routerã®æ§‹æˆ:**

- **ã™ã¹ã¦Server Component**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã¯ãªãã€ã‚µãƒ¼ãƒãƒ¼å´ã§HTMLã‚’ç”Ÿæˆ
- **Static Generationï¼ˆSSGï¼‰**: ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒšãƒ¼ã‚¸ã‚’äº‹å‰ç”Ÿæˆ
- **Draft Modeæ™‚ã®ã¿SSR**: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã ã‘ã‚µãƒ¼ãƒãƒ¼å´ã§å‹•çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

**å„ãƒšãƒ¼ã‚¸ã®å½¹å‰²:**

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `app/page.tsx` | ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã€‚ãƒ’ãƒ¼ãƒ­ãƒ¼è¨˜äº‹ï¼‹è¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤º |
| `app/posts/[slug]/page.tsx` | è¨˜äº‹è©³ç´°ãƒšãƒ¼ã‚¸ã€‚`generateStaticParams` ã§é™çš„ç”Ÿæˆ |
| `lib/markdown.tsx` | Rich Textã‚’ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¤‰æ› |
| `lib/contentful-image.tsx` | Contentfulã®ç”»åƒã‚’æœ€é©åŒ–ã—ã¦è¡¨ç¤º |

**ä½¿ç”¨ã—ã¦ã„ã‚‹æŠ€è¡“:**
- **Tailwind CSS**: ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- **date-fns**: æ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- **@contentful/rich-text-react-renderer**: ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **Next.js Image**: ç”»åƒã®æœ€é©åŒ–ï¼ˆContentfulç”¨ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼‰

---

### æ–°ã—ã„è¨˜äº‹ã‚¿ã‚¤ãƒ— (ã¾ã£ãŸãç•°ãªã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ) ã‚’è¿½åŠ ã™ã‚‹ã«ã¯
1. **Contentful ã§æ–°ã—ã„ Content Type** ã‚’ä½œæˆ (ä¾‹: `CaseStudy`)ã€‚å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (ä¾‹: `heroHeadline`, `modules`, `seoDescription` ç­‰) ã‚’å®šç¾©ã—ã€`slug` ã‚‚ç”¨æ„ã€‚
2. **GraphQL ã‚¯ã‚¨ãƒªã‚’æ‹¡å¼µ**:
   - `lib/api.ts` ã«æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚»ãƒƒãƒˆ (ä¾‹: `CASE_STUDY_GRAPHQL_FIELDS`) ã¨ `getAllCaseStudies`/`getCaseStudyAndMore` ã®ã‚ˆã†ãªé–¢æ•°ã‚’è¿½åŠ ã€‚
   - `fetchGraphQL` ã® `next.tags` ã‚’ã‚¿ã‚¤ãƒ—åˆ¥ã‚¿ã‚° (ä¾‹: `"case-studies"`) ã«åˆ†ã‘ã¦ãŠãã¨ Revalidate ã‚’åˆ¶å¾¡ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚
3. **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**:
   - `app/case-studies/[slug]/page.tsx` ã®ã‚ˆã†ãªæ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã€`generateStaticParams` ã¨ `generateMetadata` (ä»»æ„) ã‚’å®Ÿè£…ã€‚
   - æ—¢å­˜ã® `app/page.tsx` ã¨ã¯åˆ¥ã« `app/case-studies/page.tsx` ã‚’ç½®ãã‹ã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã‚’ä¸¦åˆ—è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã« `getAllPosts` ã®çµæœã¨åˆç®—ã—ã¾ã™ã€‚
4. **UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
   - `components` or `app` é…ä¸‹ã«ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£å°‚ç”¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã€Contentful ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ§‹é€ ã«åˆã‚ã›ã¦æç”»ã€‚
   - `lib/markdown.tsx` ã®ã‚ˆã†ã« Rich Text / Modular Content ã‚’æç”»ã™ã‚‹è£œåŠ©é–¢æ•°ã‚’å¿…è¦ã«å¿œã˜è¿½åŠ ã—ã¾ã™ã€‚
5. **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼/å†æ¤œè¨¼å¯¾å¿œ**:
   - Draft Mode ã§æ–°ã‚¿ã‚¤ãƒ—ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å ´åˆã€Contentful ã® Content Preview URL ã‚’ `/case-studies/api/draft?...` ãªã©æ–°ãƒ«ãƒ¼ãƒˆã«åˆã‚ã›ã¦è¨­å®šã€‚
   - Webhook ã‹ã‚‰ `revalidateTag("case-studies")` ã‚‚å‘¼ã¹ã‚‹ã‚ˆã†ã€`app/api/revalidate/route.ts` ã‚’æ‹¡å¼µã—ã¦ Contentful ã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ `sys.contentType.sys.id` ã«å¿œã˜ã‚¿ã‚°ã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹å®Ÿè£…ã«ã™ã‚‹ã¨æ‹¡å¼µæ€§ãŒé«˜ã„ã§ã™ã€‚

### è£œè¶³: ä¸»ãªãƒ•ã‚¡ã‚¤ãƒ«ã¨å½¹å‰²
- `app/page.tsx` â€“ ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã€‚`draftMode` ã«å¿œã˜ã¦ Delivery/Preview API ã‚’åˆ‡ã‚Šæ›¿ãˆã€Hero + More Stories ã‚’è¡¨ç¤ºã€‚
- `app/posts/[slug]/page.tsx` â€“ è¨˜äº‹è©³ç´°ã€‚`generateStaticParams` ã§ SSG ã‚’æ‹…ã„ã€`Markdown` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ RichText ã‚’æç”»ã€‚
- `app/api/draft|disable-draft|revalidate/route.ts` â€“ Draft Mode åˆ‡ã‚Šæ›¿ãˆã¨ Resvalidation APIã€‚
- `lib/api.ts` â€“ GraphQL ã‚¯ã‚¨ãƒªé›†ã€‚`next: { tags: ["posts"] }` ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’è¨­å®šã€‚
- `lib/markdown.tsx` â€“ Contentful Rich Text â†’ React ã¸ã®å¤‰æ›ã€‚Embedded Asset ã‚’ `next/image` ã§æç”»ã€‚
- `lib/contentful-image.tsx` â€“ ç”»åƒ Loaderã€‚
- `lib/setup.js` â€“ Contentful ã¸ã® Content Model ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚
- `tailwind.config.ts` â€“ `@tailwindcss/typography` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ Inter ãƒ•ã‚©ãƒ³ãƒˆå¤‰æ•°è¨­å®šã€‚

---

## ä»Šå¾Œã®ç™ºå±•ã‚¢ã‚¤ãƒ‡ã‚¢
1. è¨˜äº‹ã”ã¨ã® `generateMetadata` (Open Graph/Twitter) ã‚’å®Ÿè£…ã—ã€SNS ã‚·ã‚§ã‚¢æœ€é©åŒ–ã‚’è¡Œã†ã€‚
2. Contentful ã® Webhook ã‹ã‚‰é€ã‚‰ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥ã”ã¨ã« `revalidateTag` ã‚’ç´°åˆ†åŒ–ã—ã€å¿…è¦ãªãƒšãƒ¼ã‚¸ã®ã¿å†ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã‚³ã‚¹ãƒˆå‰Šæ¸›ã‚’å›³ã‚‹ã€‚
3. ç•°ãªã‚‹è¨˜äº‹ã‚¿ã‚¤ãƒ—ã‚’å¢—ã‚„ã™éš›ã¯ `Contentful GraphQL` ã®è‡ªå‹•ç”Ÿæˆ (codegen) ã‚„ `zod` ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å°å…¥ã—ã€å‹ã®å®‰å…¨æ€§ã‚’é«˜ã‚ã‚‹ã€‚
